<!doctype html>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0,minimum-scale=1.0,user-scalable=0" />
		<title>Git</title>
		<style>
			.class___line_head {
				margin-left : 2em;
			}
			.class___tab_place {
				margin-left : 2em;
			}
			.class___center {
				text-align : center;
				width : 100%;
				display : inline-block;
			}
			.shell_instruction, .class___shell {
				color : yellow;
				background-color : black;
				font-weight : 800;
				padding : 4px;
			}
			section > p {
				padding-left : 2em;
				line-height : 180%;
			}
			section > div {
				padding-left : 2em;
				line-height : 180%;
			}
		</style>
		<script>
		</script>
	</head>
	<body>
		<article>
			<header>
				<h3>Git</h3>
				<div>
					Git spread log.
					<br/>
					<a target="_blank" href="https://git-scm.com/">Git</a>
					<br/>
					<a target="_blank" href="https://git-scm.com/doc">Git - Documentation</a>
					<br/>
					<a target="_blank" href="https://git-scm.com/docs">Git - Reference</a>
					<br/>
					<a target="_blank" href="https://git-scm.com/book/en/v2">Git - Book</a>
					<br/>
					<a target="_blank" href="http://gitbook.liuhui998.com/index.html">Git Community Book 中文版</a>
				</div>
			</header>
			<section>
				<h3>git 复制大项目断点续传</h3>
				<div>
					当项目比较大或网速较低的情况下会导致git clone不能成功
					<br/>
					可以在<span class="class___shell">git clone</span>时加上参数<span class="">--depth=1</span>指定进行浅(shallow)拷贝, 即只拷贝一个分支的最后一个节点, 含有最后一次的提交记录及最后一次提交后完整的文件树, 从而只先复制一部分的数据
					<br/>
					可以用<span class="class___shell">git fetch --depth=3</span>或<span class="">git fetch --deepen=3</span>来拷贝更多的历史即提交记录, 如此处的3就是3条提交记录, 若为2就是2条提交记录
					<br/>
					最后用<span class="class___shell">git fetch --unshallow</span>或<span class="class___shell">git pull --unshallow</span>将浅拷贝的库转换为完整的存储库，消除浅存储库所施加的所有限制. 所有的分支都被复制下来
					<br/>
					<br/>
					另一个方法是现在本地建一个与项目同名的文件夹, 然后用<span class="class___shell">git init</span>初始化
					<br/>
					再用<span class="class___shell">git fetch --depth=1 url</span>复制
					<br/>
					然后用<span class="class___shell">git checkout FETCH_HEAD</span>检出到HEAD分支
					<br/>
					若用<span class="class___shell">git fetch --depth=1 url branch_name</span>复制则可省略上面检出那步
					<br/>
					最后用<span class="class___shell">git fetch --unshallow</span>或<span class="class___shell">git pull --unshallow</span>将浅拷贝的库转换为完整的存储库，消除浅存储库所施加的所有限制. 所有的分支都被复制下来
					<br/>
					<br/>
					可参考:
					<br/>
					<a target="_blank" href="https://git-scm.com/docs/git-fetch">Git - git-fetch Documentation</a>
					<br/>
					<a target="_blank" href="https://git-scm.com/docs/git-clone">Git - git-clone Documentation</a>
					<br/>
					<a target="_blank" href="https://git-scm.com/docs/git-checkout">Git - git-checkout Documentation</a>
				</div>
			</section>
			<section>
				<h3>git rm filename with git rm --cached filename</h3>
				<div>
					git rm filename： 同时从工作区和索引中删除文件。即本地的文件也被删除了。
					<br/>
					git rm --cached filename： 从索引中删除文件。但是本地文件还存在， 只是不希望这个文件被版本控制。
				</div>
			</section>
			<section>
				<h3>git diff, git diff --cached, git diff --staged, git diff HEAD</h3>
				<p>
					<span class="">git diff : 對工作區(未使用 git add 的文件)和暫存區(使用 git add 的文件)進行比較</span>
					<br/>
					<span class="">git diff --cached : 對暫存區(使用 git add 的文件)和版本庫(使用 git commit 之後的文件)進行比較</span>
					<br/>
					<span class="">git diff --staged : 與 git diff --cached 相同, 對暫存區(使用 git add 的文件)和版本庫(使用 git commit 之後的文件)進行比較</span>
					<br/>
					<span class="">git diff : 對工作區(未使用 git add 的文件)和版本庫(使用 git commit 之後的文件)進行比較</span>
					<br/>
				</p>
			</section>
			<section>
				<h3>git remove remote branch</h3>
				<p>
					<span class="shell_instruction">git push 遠程庫名稱如origin -d 分支名稱</span>
					<br/>
					or
					<br/>
					<span class="shell_instruction">git push 遠程庫名稱如origin : 分支名稱</span>
				</p>
			</section>
			<section>
				<h3>git server via ssh</h3>
				<p>
					#in server
					<br/>
					#use vim edit sshd_config file
					<br/>
					#find "Port 22", in the line head delete "#" to enable this configuration item
					<br/>
					#find "Protocol 2", in the line head delete "#" to enable this configuration item
					<br/>
					#find "PubkeyAuthentication yes", in the line head delete "#" to enable this configuration item
					<br/>
					#find "AuthorizedKeysFile  .ssh/authorized_keys", in the line head delete "#" to enable this configuration item
					<br/>
					#if use ssh connect sshd server appear "The authenticity of host '192.168.8.101 (192.168.8.101)' can't be established.", then use vim edit /etc/ssh/ssh_config file, set StrictHostKeyChecking no
					<br/>
					#create a user name is git
					<br/>
					<span class="shell_instruction">adduser git</span>
					<br/>
					#set git user password
					<br/>
					<span class="shell_instruction">passwd git</span>
					<br/>
					#change to git user
					<br/>
					<span class="shell_instruction">su git</span>
					<br/>
					#change path to git user home path
					<br/>
					<span class="shell_instruction">cd ~</span>
					<br/>
					#create a empty git bare repository, repository_name is the new repository name
					<br/>
					<span class="shell_instruction">git init --bare repository_name.git</span>
					<br/>
					#if .ssh folder not exist then create .ssh folder
					<br/>
					<span class="shell_instruction">mkdir .ssh</span>

					<br/>
					<br/>
					#in client
					<br/>
					#create ssh key, after -C is comment
					<br/>
					<span class="shell_instruction">ssh-keygen -t rsa -C client_user_name</span>
					<br/>
					#change path to .ssh path
					<br/>
					<span class="shell_instruction">cd ~/.ssh</span>
					<br/>
					#copy id_rsa.pub file to server, git is server username, 192.168.1.110 is server ip
					<br/>
					<span class="shell_instruction">scp id_rsa.pub git@192.168.1.110:id_rsa.pub</span>

					<br/>
					<br/>
					#in server
					<br/>
					#export the client id_rsa.pub file content to ~/.ssh/authorized_keys file
					<br/>
					<span class="shell_instruction">cd ~</span>
					<br/>
					<span class="shell_instruction">cat id_rsa.pub &gt;&gt; .ssh/authorized_keys</span>
					<br/>
					#set git user ssh only use git shell, edit /etc/passwd file
					<br/>
					<span class="shell_instruction">vim /etc/passwd</span>
					<br/>
					#change
					<br/>
					<span style="color : blue;">git:x:1001:1001::/home/git:/bin/bash</span>
					<br/>
					#to
					<br/>
					<span style="color : blue;">git:x:1001:1001::/home/git:/usr/bin/git-shell</span>
					<br/>
					#if you don't want input git user's login password do the next two step
					<br/>
					#change .ssh authority
					<br/>
					<span class="shell_instruction">chmod 700 ~/.ssh</span>
					<br/>
					#change .ssh/authorized_keys authority
					<br/>
					<span class="shell_instruction">chmod 600 ~/.ssh/authorized_keys</span>


					<br/>
					<br/>
					#in client
					<br/>
					#clone the new repository from server
					<br/>
					<span class="shell_instruction">git clone git@192.168.1.110:repository_name.git</span>
				</p>
			</section>
			<section>
				<h3>git server</h3>
				<p>
					//install git and git-daemon
					<br/>
					<br/>
					//generate rsa key pair with the follow instruct
					<br/>
					<span class="shell_instruction">ssh-keygen -t rsa -C comment</span>
					<br/>
					<br/>
					//create a empty file in ~/.ssh/
					<br/>
					<span class="shell_instruction">cd ~/.ssh/</span>
					<br/>
					<span class="shell_instruction">touch authorized_keys</span>
					<br/>
					<br/>
					//export rsa public key file content to authorized_keys file
					<br/>
					<span class="shell_instruction">cat ~/.ssh/id_rsa.pub &gt;&gt; ~/.ssh/authorized_keys</span>
					<br/>
					//note : every client need export the res public key file content to the server's authorized_keys
					<br/>
					<br/>
					//set sshd server
					<br/>
					<span class="shell_instruction">cd /etc/ssh</span>
					<br/>
					//use vim edit sshd_config file
					<br/>
					//find "Port 22", in the line head delete "#" to enable this configuration item
					<br/>
					//find "Protocol 2", in the line head delete "#" to enable this configuration item
					<br/>
					//find "PubkeyAuthentication yes", in the line head delete "#" to enable this configuration item
					<br/>
					//find "AuthorizedKeysFile  .ssh/authorized_keys", in the line head delete "#" to enable this configuration item
					<br/>
					#if use ssh connect sshd server appear "The authenticity of host '192.168.8.101 (192.168.8.101)' can't be established.", then use vim edit /etc/ssh/ssh_config file, set StrictHostKeyChecking no
					<br/>
					<br/>
					//restart sshd server
					<br/>
					<span class="shell_instruction">service sshd restart</span>
					<br/>
					<br/>
					//use mkdir to crate a folder as the git repository
					<br/>
					<span class="shell_instruction">mkdir git_base</span>
					<br/>
					<span class="shell_instruction">cd git_base</span>
					<br/>
					<br/>
					//initialization a git repository,the repositoy_name is your project name, create a empty file
					<br/>
					<span class="shell_instruction">git init --bare repository_name.git</span>
					<br/>
					<span class="shell_instruction">touch repositoy_name.git/git-daemon-export-ok</span>
					<br/>
					<br/>
					//start git protocol sever
					<br/>
					<span class="shell_instruction">git daemon --reuseaddr --base-path=~/git_base</span>
					<br/>
					<br/>

					//in client clone the project code
					<br/>
					//the format is git clone http://username:password@127.0.0.1/repositoy_name.git
					<br/>
					<span class="shell_instruction">git clone git://127.0.0.1/repositoy_name.git</span>
					<br/>
					//or
					<br/>
					<span class="shell_instruction">git clone username@localhost:/repositoy_name.git</span>
					<br/>
				</p>
			</section>
		</article>
	</body>
</html>
